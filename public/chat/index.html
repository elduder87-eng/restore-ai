<!DOCTYPE html>
<html>
<head>
  <title>Restore AI — Teacher Mode</title>

  <style>
    body {
      font-family: Arial;
      background:#f3f4f6;
      margin:0;
    }

    header{
      background:#0f172a;
      color:white;
      padding:12px;
      text-align:center;
      font-weight:bold;
    }

    .container{
      max-width:900px;
      margin:30px auto;
      background:white;
      padding:20px;
      border-radius:8px;
      box-shadow:0 2px 6px rgba(0,0,0,.1);
    }

    #chatBox{
      height:400px;
      overflow-y:auto;
      border:1px solid #ddd;
      padding:10px;
      margin-bottom:10px;
    }

    input{
      width:80%;
      padding:10px;
    }

    button{
      padding:10px 15px;
      background:#2563eb;
      color:white;
      border:none;
      border-radius:4px;
    }

    .user { color:#2563eb; margin:8px 0; }
    .ai { margin:8px 0; }
  </style>
</head>

<body>

<header>Restore AI — Teacher Mode</header>

<div class="container">

  <div id="chatBox"></div>

  <input id="messageInput" placeholder="Ask a question..." />
  <button onclick="sendMessage()">Send</button>

</div>

<script>

let history =
  JSON.parse(localStorage.getItem("history")) || [];

let learnerProfile =
  JSON.parse(localStorage.getItem("learnerProfile")) || {
    curiosityLevel:1,
    misconceptions:[],
    topicsDiscussed:[],
    understandingScore:1
  };

const chatBox = document.getElementById("chatBox");

function renderHistory(){
  chatBox.innerHTML = "";

  history.forEach(msg=>{
    const div = document.createElement("div");

    if(msg.role==="user"){
      div.className="user";
      div.innerHTML="<b>You:</b> "+msg.content;
    } else {
      div.className="ai";
      div.innerHTML="<b>Restore AI:</b> "+msg.content;
    }

    chatBox.appendChild(div);
  });

  chatBox.scrollTop = chatBox.scrollHeight;
}

renderHistory();

function updateLearnerProfile(text){

  text = text.toLowerCase();

  if(text.includes("?"))
    learnerProfile.curiosityLevel++;

  if(text.includes("heavier objects fall faster")){
    if(!learnerProfile.misconceptions.includes("gravity_speed")){
      learnerProfile.misconceptions.push("gravity_speed");
    }
  }

  if(text.includes("gravity")){
    if(!learnerProfile.topicsDiscussed.includes("gravity")){
      learnerProfile.topicsDiscussed.push("gravity");
    }
  }

  learnerProfile.understandingScore += 0.2;

  localStorage.setItem(
    "learnerProfile",
    JSON.stringify(learnerProfile)
  );
}

async function sendMessage(){

  const input = document.getElementById("messageInput");
  const message = input.value.trim();
  if(!message) return;

  history.push({role:"user", content:message});
  updateLearnerProfile(message);

  renderHistory();
  input.value="";

  const res = await fetch("/api/chat",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      message,
      history,
      learnerProfile
    })
  });

  const data = await res.json();

  history.push({
    role:"assistant",
    content:data.reply
  });

  localStorage.setItem("history", JSON.stringify(history));

  renderHistory();
}

</script>

</body>
</html>
